<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EarnBDT | Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif;}
body{background:linear-gradient(135deg,#43cea2,#185a9d);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;}

.header{
  width:100%;
  max-width:500px;
  background:#fff;
  padding:25px;
  border-radius:15px;
  box-shadow:0 8px 25px rgba(0,0,0,.2);
  text-align:center;
  margin-bottom:20px;
  transition:0.3s;
}
.header:hover{box-shadow:0 12px 30px rgba(0,0,0,.3);}
.header h2{font-size:22px;color:#333;margin-bottom:5px;}
.header p{color:#555;margin-bottom:10px;}
.header button{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:#ff5e62;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
.header button:hover{background:#ff3a3f;}

.card{
  width:100%;
  max-width:500px;
  background:#fff;
  padding:20px;
  border-radius:15px;
  box-shadow:0 8px 25px rgba(0,0,0,.2);
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  transition:0.3s;
}
.card:hover{box-shadow:0 12px 30px rgba(0,0,0,.3);}
.card h3{margin:0;color:#333;}
.card button{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:#667eea;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
.card button:hover{background:#5a67d8;}

.grid{
  width:100%;
  max-width:500px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  margin-bottom:20px;
}
.grid button{
  padding:25px;
  border:none;
  border-radius:15px;
  background:#fff;
  color:#333;
  font-size:16px;
  cursor:pointer;
  font-weight:bold;
  box-shadow:0 8px 25px rgba(0,0,0,.2);
  transition:0.3s;
}
.grid button:hover{background:#f0f0f0;transform:translateY(-3px);}

.footer{
  color:#fff;
  font-weight:bold;
  margin-top:10px;
}

/* Floating WhatsApp Button */
.whatsapp-float{
  position:fixed;
  bottom:20px;
  right:20px;
  width:60px;
  height:60px;
  background:#25d366;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:0 5px 20px rgba(0,0,0,.3);
  cursor:pointer;
  transition:0.3s;
  z-index:1000;
}
.whatsapp-float:hover{transform:scale(1.1);}
.whatsapp-float img{width:35px; height:35px;}
</style>
</head>
<body>

<div class="header">
  <h2 id="username">Username</h2>
  <p id="email">user@example.com</p>
  <button onclick="logout()">Logout</button>
</div>

<div class="card">
  <h3>Balance: <span id="balance">0</span> BDT</h3>
  <button onclick="withdraw()">Withdraw</button>
</div>

<div class="grid">
  <button onclick="watchAds()">Watch Ads</button>
  <button onclick="dailyReward()">Daily Reward</button>
  <button onclick="taskComplete()">Daily Tasks</button>
  <button onclick="window.location.href='ref.html'">Refer & Earn</button>
  <button onclick="window.location.href='history.html'">My History</button>
</div>

<div class="footer">@EarnBDT - Ahyan Creations LTD</div>

<!-- Floating WhatsApp Button -->
<div class="whatsapp-float" id="whatsappBtn">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDNkACe_Drga8Uzm-mGMKKLvignadR7jN0",
  authDomain: "earnbdtapp.firebaseapp.com",
  databaseURL: "https://earnbdtapp-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "earnbdtapp",
  storageBucket: "earnbdtapp.firebasestorage.app",
  messagingSenderId: "407276444050",
  appId: "1:407276444050:web:b6ff2e075202716b5e094b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUserEmail = "";

/* Load User Info */
onAuthStateChanged(auth, user => {
  if(user){
    const uid = user.uid;
    get(ref(db,"users/"+uid)).then(snapshot=>{
      if(snapshot.exists()){
        const data = snapshot.val();
        document.getElementById("username").innerText = data.username || "User";
        document.getElementById("email").innerText = data.email || user.email;
        document.getElementById("balance").innerText = data.balance || 0;
        currentUserEmail = data.email || user.email;
      }
    });
  }else{
    window.location.href = "login.html";
  }
});

/* Logout */
window.logout = function(){
  signOut(auth).then(()=>{ window.location.href = "login.html"; });
}

/* Update Balance Helper */
async function updateBalance(uid, amount){
  const balRef = ref(db,"users/"+uid+"/balance");
  const snap = await get(balRef);
  let currentBalance = snap.val() || 0;
  currentBalance += amount;
  await set(balRef,currentBalance);
  document.getElementById("balance").innerText = currentBalance;
  return currentBalance;
}

/* Watch Ads (App placeholder) */
window.watchAds = async function(){ alert("Watch Ads in App to earn points!"); }

/* Daily Reward +2 points once/day */
window.dailyReward = async function(){
  const user = auth.currentUser;
  if(!user) return;
  const uid = user.uid;
  const today = new Date().toLocaleDateString();
  const rewardRef = ref(db,"users/"+uid+"/dailyRewardDate");
  const snap = await get(rewardRef);
  if(snap.exists() && snap.val() === today){
    alert("আপনি আজ ইতিমধ্যেই Daily Reward নিয়েছেন।");
  }else{
    await updateBalance(uid,2);
    await set(rewardRef,today);
    alert("Daily Reward 2 পয়েন্ট যোগ হয়েছে!");
  }
}

/* Daily Task +5 points */
window.taskComplete = async function(){
  const user = auth.currentUser;
  if(!user) return;
  const uid = user.uid;
  await updateBalance(uid,5);
  alert("Task Complete! 5 পয়েন্ট যোগ হয়েছে।");
  window.location.href="task.html";
}

/* Withdraw → only if balance >=1050 */
window.withdraw = async function(){
  const user = auth.currentUser;
  if(!user) return;
  const uid = user.uid;
  const snap = await get(ref(db,"users/"+uid+"/balance"));
  const balance = snap.val() || 0;
  if(balance < 1050){
    alert("Withdraw এর জন্য আপনার ব্যালেন্স কমপক্ষে 1050 পয়েন্ট হতে হবে!");
    return;
  }
  window.location.href="withdraw.html";
}

/* Floating WhatsApp Button Click */
document.getElementById("whatsappBtn").addEventListener("click", ()=>{
  const phone = "+8801604444716";
  const msg = encodeURIComponent(`Assalamualaikum Admin, My email: ${currentUserEmail}, I have a problem and that is....`);
  window.open(`https://wa.me/${phone}?text=${msg}`,"_blank");
});
</script>

</body>
</html>
