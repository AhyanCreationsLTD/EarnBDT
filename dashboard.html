<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard - EarnBDT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;margin:0;background:#f4f6f9;}
.header{background:#0a7cff;color:#fff;padding:15px;text-align:center;}
.card{background:#fff;margin:15px;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);}
button{padding:10px 15px;margin:5px;border:none;border-radius:5px;background:#28a745;color:#fff;cursor:pointer;}
.link{margin-top:10px;display:block;color:#0a7cff;text-decoration:none;}
.note{font-size:14px;color:#555;}
</style>
</head>
<body>

<div class="header">
  <h2 id="userName">Loading...</h2>
  <p id="userEmail"></p>
  <button onclick="logout()">Logout</button>
</div>

<div class="card">
  <h3>Balance</h3>
  <p id="balanceText">Loading...</p>
  <p class="note">Note: 1050 points = 100 BDT</p>
  <a href="withdraw.html"><button>Withdraw</button></a>
</div>

<div class="card">
  <button onclick="watchAd()">Watch Ads (+10 points)</button>
  <button onclick="dailyReward()">Daily Reward (+2 points)</button>
  <a href="task.html"><button>Daily Tasks (+5 points per task)</button></a>
  <a href="ref.html"><button>Refer & Earn</button></a>
  <a href="history.html"><button>My History</button></a>
</div>

<p style="text-align:center;margin-top:30px;">@EarnBDT - Ahyan Creations LTD</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDNkACe_Drga8Uzm-mGMKKLvignadR7jN0",
  authDomain: "earnbdtapp.firebaseapp.com",
  databaseURL: "https://earnbdtapp-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "earnbdtapp",
  storageBucket: "earnbdtapp.firebasestorage.app",
  messagingSenderId: "407276444050",
  appId: "1:407276444050:web:b6ff2e075202716b5e094b"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUid;

onAuthStateChanged(auth,user=>{
  if(!user) location.href="login.html";
  currentUid=user.uid;
  document.getElementById("userName").innerText=user.email.split("@")[0];
  document.getElementById("userEmail").innerText=user.email;
  loadBalance();
});

function logout(){ signOut(auth).then(()=>location.href="login.html"); }

function loadBalance(){
  get(ref(db,"users/"+currentUid)).then(snap=>{
    if(snap.exists()){
      document.getElementById("balanceText").innerText=snap.val().balance || 0 + " points";
    }
  });
}

// Daily reward
function dailyReward(){
  const today = new Date().toDateString();
  const key = "lastDaily";
  get(ref(db,"users/"+currentUid+"/"+key)).then(snap=>{
    if(snap.exists() && snap.val()===today){ alert("You already claimed today!"); return; }
    get(ref(db,"users/"+currentUid)).then(userSnap=>{
      const bal=(userSnap.val().balance||0)+2;
      update(ref(db,"users/"+currentUid),{balance:bal,lastDaily:today});
      alert("+2 points added!");
      loadBalance();
    });
  });
}

// Watch Ad
function watchAd(){
  get(ref(db,"users/"+currentUid)).then(userSnap=>{
    const bal=(userSnap.val().balance||0)+10;
    update(ref(db,"users/"+currentUid),{balance:bal});
    alert("+10 points added!");
    loadBalance();
  });
}
</script>
</body>
</html>
