<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EarnBDT | Withdraw History</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif;}
body{background:#f0f2f5;padding:20px;}
h2{text-align:center;margin-bottom:20px;}
.table{width:100%;max-width:1000px;margin:auto;border-collapse:collapse;}
.table th, .table td{border:1px solid #ccc;padding:10px;text-align:center;}
.table th{background:#667eea;color:#fff;}
.status-Pending{color:#ffc107;font-weight:bold;}
.status-Approved{color:#28a745;font-weight:bold;}
.status-Rejected{color:#dc3545;font-weight:bold;}
.status-Paid{color:#17a2b8;font-weight:bold;}
</style>
</head>
<body>

<h2>My Withdraw History</h2>
<table class="table" id="historyTable">
<thead>
<tr>
<th>Payment Method</th>
<th>Amount</th>
<th>Status</th>
<th>Requested At</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDNkACe_Drga8Uzm-mGMKKLvignadR7jN0",
  authDomain: "earnbdtapp.firebaseapp.com",
  databaseURL: "https://earnbdtapp-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "earnbdtapp",
  storageBucket: "earnbdtapp.firebasestorage.app",
  messagingSenderId: "407276444050",
  appId: "1:407276444050:web:b6ff2e075202716b5e094b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

onAuthStateChanged(auth, user=>{
  if(!user){window.location.href="login.html";return;}
  const uid = user.uid;

  const withdrawRef = ref(db,"withdraw_requests");
  const tbody = document.getElementById("historyTable").querySelector("tbody");

  onValue(withdrawRef, snapshot=>{
    tbody.innerHTML="";
    snapshot.forEach(child=>{
      const data = child.val();
      if(data.uid===uid){
        const tr = document.createElement("tr");
        const statusClass = "status-"+data.status;
        tr.innerHTML = `
          <td>${data.paymentMethod}</td>
          <td>${data.amount}</td>
          <td class="${statusClass}">${data.status}</td>
          <td>${new Date(data.timestamp).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      }
    });
  });
});
</script>
</body>
            </html>
